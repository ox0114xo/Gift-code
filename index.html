<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è´éº»å°åŠ©æ‰‹</title>
    
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/ox0114xo/Gift-code/refs/heads/main/IMG_20260220_102243.png">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/ox0114xo/Gift-code/refs/heads/main/IMG_20260220_102243.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="è´éº»å°åŠ©æ‰‹">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#f2f4f7">
    <link rel="manifest" id="pwa-manifest">

    <style>
        /* æ¥µç°¡åŒ– CSS */
        body,html { margin:0; padding:0; font-family:-apple-system,BlinkMacSystemFont,sans-serif; background:#f2f4f7; color:#333; user-select:none; }
        * { box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
        .wrap { max-width:600px; margin:0 auto; padding:15px; min-height:100vh; }
        h2 { text-align:center; color:#2c3e50; margin:5px 0 20px; font-size:1.8rem; font-weight:900; }
        
        .dash { display:flex; background:#fff; padding:15px; border-radius:16px; margin-bottom:15px; text-align:center; box-shadow:0 4px 10px rgba(0,0,0,.05); }
        .dash div { flex:1; }
        .dash span { font-size:.85rem; color:#95a5a6; font-weight:700; }
        .dash strong { display:block; font-size:1.5rem; color:#2c3e50; font-weight:900; }
        
        .ctrl { display:flex; gap:8px; margin-bottom:15px; position:sticky; top:10px; z-index:10; background:rgba(242,244,247,.95); padding:5px 0; backdrop-filter:blur(5px); }
        .ctrl button { flex:1; padding:12px 0; border:none; border-radius:50px; background:#fff; font-weight:bold; color:#555; box-shadow:0 2px 8px rgba(0,0,0,.08); cursor:pointer; }
        .ctrl button.on { background:#2c3e50; color:#fff; }
        
        .copy-btns { display:flex; gap:10px; margin-bottom:20px; }
        .copy-btns .btn { margin-bottom:0; flex:1; font-size:0.95rem; padding:12px 0; }
        .btn-new { background:linear-gradient(135deg, #e74c3c, #c0392b); color:#fff; box-shadow:0 4px 15px rgba(231,76,60,.3); }
        .btn-old { background:linear-gradient(135deg, #7f8c8d, #95a5a6); color:#fff; box-shadow:0 4px 15px rgba(127,140,141,.3); }

        .card { background:#fff; padding:18px; border-radius:16px; margin-bottom:12px; position:relative; border:1px solid #f0f0f0; }
        .card.r { opacity:.6; background:#f8f9fa; }
        .card.p { background:#fffcf2; }
        .card.b { opacity:.7; background:#fff5f5; }
        .c-top { display:flex; justify-content:space-between; margin-bottom:12px; align-items:center; }
        .c-top strong { color:#e74c3c; font-size:1.3rem; font-weight:800; }
        .c-top span { background:#eee; padding:3px 8px; border-radius:6px; font-size:.8rem; margin-left:8px; font-weight:bold; color:#555; }
        .note { color:#888; font-size:.9rem; max-width:60%; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; text-align:right;}
        .code { background:#ebf5ff; color:#007bff; border:2px dashed #a6cfff; padding:14px; text-align:center; border-radius:10px; font-family:monospace; font-size:1.4rem; font-weight:bold; margin-bottom:12px; cursor:pointer; }
        
        .acts { display:flex; justify-content:space-between; border-top:1px solid #eee; padding-top:12px; align-items:center; }
        .acts a { color:#999; font-size:.85rem; padding:6px 10px; background:#f9f9f9; border-radius:8px; cursor:pointer; }
        label { display:flex; align-items:center; gap:8px; font-weight:bold; color:#555; cursor:pointer; }
        input[type="checkbox"] { width:22px; height:22px; accent-color:#27ae60; }
        
        .btn { width:100%; padding:14px; border:none; border-radius:12px; font-weight:bold; font-size:1.05rem; cursor:pointer; }
        #toast { position:fixed; bottom:-50px; left:50%; transform:translateX(-50%); background:rgba(30,30,30,.9); color:#fff; padding:12px 24px; border-radius:50px; transition:.3s; z-index:99; font-weight:bold; }
        
        .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.6); align-items:center; justify-content:center; z-index:100; backdrop-filter:blur(2px); }
        .m-box { background:#fff; padding:25px; border-radius:20px; width:85%; max-width:320px; text-align:center; }

        .install-bar { display:none; position:fixed; bottom:20px; left:50%; transform:translateX(-50%); width:92%; max-width:450px; background:#2c3e50; color:#fff; padding:14px; border-radius:16px; box-shadow:0 10px 25px rgba(0,0,0,0.3); z-index:999; align-items:center; gap:12px; animation:slideUp 0.5s; }
        .i-logo { width:45px; height:45px; border-radius:10px; }
        .i-text { flex:1; font-size:0.9rem; }
        .i-btn { background:#27ae60; color:#fff; border:none; padding:8px 15px; border-radius:50px; font-weight:bold; }
        @keyframes slideUp { from { bottom:-100px; } to { bottom:20px; } }
    </style>
</head>
<body>
    <div class="wrap">
        <h2>è´éº»å°åŠ©æ‰‹</h2>
        
        <div class="dash">
            <div><span>ç¦®åŒ…ç¸½æ•¸</span><strong id="v-cnt">0</strong></div>
            <div><span>ç¸½ç¦åˆ©</span><strong id="v-pts" style="color:#e74c3c">0</strong></div>
        </div>

        <div class="ctrl">
            <button id="b-date" class="on" onclick="app.sort('d')">ğŸ“… æ—¥æœŸ</button>
            <button id="b-pts" onclick="app.sort('p')">ğŸ’° é»æ•¸</button>
            <button id="b-fil" onclick="app.filt()">ğŸ“‹ æœªé ˜</button>
        </div>

        <div class="copy-btns">
            <button class="btn btn-new" onclick="app.copyGroup('new')">ğŸ†• ä¸€éµè¤‡è£½æ–°ç¾¤</button>
            <button class="btn btn-old" onclick="app.copyGroup('old')">ğŸ—„ï¸ ä¸€éµè¤‡è£½èˆŠç¾¤</button>
        </div>

        <div id="loading" style="text-align:center;color:#e67e22;font-weight:bold;padding:20px;">ğŸ”„ é€£ç·šä¸­...</div>
        <div style="font-weight:bold;color:#555;margin-bottom:10px;padding-left:10px;border-left:4px solid #e74c3c;">ğŸ”¥ æœ€æ–°ç¦®åŒ…å€</div>
        <div id="list"></div>
        <button class="btn" style="background:#e0e0e0;color:#555;margin-top:15px;" onclick="document.getElementById('old').style.display='block';this.style.display='none';">ğŸ“‚ é¡¯ç¤ºæ­·å²åº«å­˜ â–¼</button>
        <div id="old" style="display:none"></div>
        <div style="text-align:center; margin:40px 0;"><span style="font-size:0.9rem; color:#ccc; cursor:pointer;" onclick="app.reset()">é‡ç½®ç´€éŒ„</span></div>
    </div>

    <div id="toast"></div>

    <div id="mod" class="modal">
        <div class="m-box">
            <h3 style="margin-top:0">å›å ±å¤±æ•ˆ</h3>
            <button class="btn" style="background:#fff5f5;color:#e74c3c;border:1px solid #ffcccc;margin-bottom:10px" onclick="app.rep('éæœŸ')">ğŸ“… å·²éæœŸ</button>
            <button class="btn" style="background:#fff5f5;color:#e74c3c;border:1px solid #ffcccc;margin-bottom:10px" onclick="app.rep('é ˜å®Œ')">ğŸ˜« å·²é ˜å®Œ</button>
            <button class="btn" style="background:#fff;border:1px solid #eee;" onclick="document.getElementById('mod').style.display='none'">å–æ¶ˆ</button>
        </div>
    </div>

    <div id="install-bar" class="install-bar">
        <img src="https://raw.githubusercontent.com/ox0114xo/Gift-code/refs/heads/main/IMG_20260220_102243.png" class="i-logo">
        <div class="i-text" id="i-desc"><strong>åŠ åˆ°æ‰‹æ©Ÿæ¡Œé¢</strong><br>ä¸€éµé–‹å•Ÿå…æ‰¾ç¶²å€</div>
        <button id="i-btn" class="i-btn">å®‰è£</button>
        <span style="padding:5px;cursor:pointer" onclick="document.getElementById('install-bar').style.display='none'">âœ•</span>
    </div>

    <script>
    const SHEET = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSkENoeJW2fV8JucN514cMysAStsgNLzjbYKrE04bDSAJOKTayexd-Ve3Fce4KB6FQsXvtMTgPZ7Mnw/pub?output=csv";
    const CUT = 213; // 2/13 ç‚ºç•Œ
    const icon = "https://raw.githubusercontent.com/ox0114xo/Gift-code/refs/heads/main/IMG_20260220_102243.png";

    // PWA Manifest
    document.getElementById('pwa-manifest').href = 'data:application/manifest+json;utf-8,'+encodeURIComponent(JSON.stringify({name:"è´éº»å°åŠ©æ‰‹",short_name:"è´éº»å°åŠ©æ‰‹",start_url:".",display:"standalone",background_color:"#f2f4f7",icons:[{src:icon,sizes:"192x192",type:"image/png"},{src:icon,sizes:"512x512",type:"image/png"}]}));
    if('serviceWorker' in navigator) navigator.serviceWorker.register(URL.createObjectURL(new Blob(["self.addEventListener('fetch',e=>{});"], {type:'text/javascript'})));

    let defPrompt;
    const isApp = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;
    if (!isApp) {
        window.addEventListener('beforeinstallprompt', e => { e.preventDefault(); defPrompt = e; document.getElementById('install-bar').style.display = 'flex'; });
        const iBtn = document.getElementById('i-btn');
        if (iBtn) iBtn.onclick = () => { if(defPrompt){ defPrompt.prompt(); defPrompt.userChoice.then(c => { if(c.outcome==='accepted') document.getElementById('install-bar').style.display='none'; }); } };
        if (/iPad|iPhone|iPod/.test(navigator.userAgent)) { setTimeout(() => { document.getElementById('install-bar').style.display='flex'; document.getElementById('i-desc').innerHTML="é»æ“Š <b>åˆ†äº«â—</b><br>é¸æ“‡ <b>åŠ åˆ°ä¸»ç•«é¢âŠ</b>"; document.getElementById('i-btn').style.display='none'; }, 1000); }
    }

    const app = {
        d: [], st: JSON.parse(localStorage.getItem('gData')) || { r:[], p:[], b:{}, s:'d', asc:false, f:false }, tId: null,
        init() {
            fetch(SHEET).then(r=>r.text()).then(c=>{
                document.getElementById('loading').style.display='none';
                let l = c.split(/\r?\n/);
                for(let i=1; i<l.length; i++){
                    let r = l[i].split(',');
                    if(r[2]) this.d.push({ d:r[0].trim(), p:+r[1], c:r[2].trim(), n:r[3]||"" });
                }
                this.rnd();
            }).catch(()=>document.getElementById('loading').innerText='âš ï¸ è®€å–å¤±æ•—');
        },
        sv() { localStorage.setItem('gData', JSON.stringify(this.st)); this.rnd(); },
        pd(d) { let a=d.split('/'); return a[0]*100 + +a[1]; },
        rnd() {
            let pts=0, a=this.d.filter(x=>{ pts+=x.p; return !this.st.f || (!this.st.r.includes(x.c) && !this.st.b[x.c]); });
            document.getElementById('v-cnt').innerText = this.d.length;
            document.getElementById('v-pts').innerText = pts.toLocaleString();
            a.sort((x,y) => this.st.s==='d' ? (this.st.asc ? this.pd(x.d)-this.pd(y.d) : this.pd(y.d)-this.pd(x.d)) : (this.st.asc ? x.p-y.p : y.p-x.p));
            let hN='', hO='';
            a.forEach(x => {
                let isR=this.st.r.includes(x.c), isP=this.st.p.includes(x.c), isB=!!this.st.b[x.c];
                let h = `<div class="card ${isB?'b':isR?'r':isP?'p':''}">${isB?'<div style="position:absolute;top:0;right:0;padding:4px 10px;font-size:0.7rem;background:#ffcccc;color:#c0392b;font-weight:bold;border-radius:0 16px 0 12px">âš ï¸å¤±æ•ˆ</div>':isP?'<div style="position:absolute;top:0;right:0;padding:4px 10px;font-size:0.7rem;background:#ffeeba;color:#b7791f;font-weight:bold;border-radius:0 16px 0 12px">â³æš«å­˜</div>':''}<div class="c-top"><div><strong>ğŸ’°${x.p}</strong><span>${x.d}</span></div><div class="note">${x.n}</div></div><div class="code" onclick="app.cp('${x.c}')">${x.c}</div><div class="acts"><div style="display:flex;gap:8px"><a onclick="app.op('${x.c}')">âš ï¸å›å ±</a><a onclick="app.tp('${x.c}')" style="color:${isP?'#d35400':'#999'}">â³è³‡æ ¼æœªç¬¦</a></div><label><input type="checkbox" onchange="app.tr('${x.c}',this.checked)" ${isR?'checked':''}>å·²é ˜</label></div></div>`;
                this.pd(x.d)>=CUT ? hN+=h : hO+=h;
            });
            document.getElementById('list').innerHTML = hN || '<div style="text-align:center;color:#999">æš«ç„¡æ–°ç¦®åŒ…</div>';
            document.getElementById('old').innerHTML = hO || '<div style="text-align:center;color:#999">æš«ç„¡æ­·å²ç¦®åŒ…</div>';
            document.getElementById('b-date').className=this.st.s==='d'?'on':'';
            document.getElementById('b-pts').className=this.st.s==='p'?'on':'';
            document.getElementById('b-fil').className=this.st.f?'on':'';
        },
        sort(k) { this.st.asc = (this.st.s===k) ? !this.st.asc : false; this.st.s=k; this.sv(); },
        filt() { this.st.f = !this.st.f; this.sv(); },
        tr(c, v) { v ? (this.st.r.push(c), this.st.p=this.st.p.filter(x=>x!==c)) : this.st.r=this.st.r.filter(x=>x!==c); this.sv(); },
        tp(c) { this.st.p.includes(c) ? this.st.p=this.st.p.filter(x=>x!==c) : this.st.p.push(c); this.sv(); },
        cp(c) { 
            if(this.st.b[c]) return this.msg('âš ï¸ è©²åºè™Ÿå·²å›å ±å¤±æ•ˆ');
            let e=document.createElement('textarea'); e.value=c; document.body.appendChild(e); e.select(); document.execCommand('copy'); e.remove();
            this.msg('âœ… å·²è¤‡è£½ä¸¦æ¨™è¨˜é ˜å–'); this.tr(c,true); 
        },
        copyGroup(t) {
            let res = this.d.filter(x => t==='new' ? this.pd(x.d)>=CUT : this.pd(x.d)<CUT).sort((a,b)=>this.pd(b.d)-this.pd(a.d));
            if(!res.length) return this.msg('âš ï¸ å°šç„¡è³‡æ–™');
            let txt = ''; res.forEach(x => txt += `${x.d} ${x.n} ${x.p}é»\n${x.c}\n\n`);
            let e=document.createElement('textarea'); e.value=txt.trim(); document.body.appendChild(e); e.select(); document.execCommand('copy'); e.remove();
            this.msg(`ğŸ“‹ å·²è¤‡è£½${t==='new'?'æ–°ç¾¤':'èˆŠç¾¤'}æ¸…å–®`);
        },
        msg(m) { let t=document.getElementById('toast'); t.innerText=m; t.style.bottom='40px'; setTimeout(()=>t.style.bottom='-50px',2000); },
        op(c) { this.tId=c; document.getElementById('mod').style.display='flex'; },
        rep(t) { this.st.b[this.tId]=t; this.sv(); document.getElementById('mod').style.display='none'; this.msg('âœ… å·²æ¨™è¨˜å¤±æ•ˆ'); },
        reset() { if(confirm('ç¢ºå®šæ¸…ç©ºç´€éŒ„ï¼Ÿ')){ localStorage.removeItem('gData'); location.reload(); } }
    };
    app.init();
    </script>
</body>
</html>
